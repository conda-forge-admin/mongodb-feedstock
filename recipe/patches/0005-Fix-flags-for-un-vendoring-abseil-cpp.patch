From 7bc8344b143d2d53af7f4e94af862d933a103683 Mon Sep 17 00:00:00 2001
From: Nehal J Wani <nehaljw.kkd1@gmail.com>
Date: Mon, 25 May 2020 02:26:17 +0000
Subject: [PATCH 05/14] Fix flags for un-vendoring abseil-cpp

---
 SConstruct                 | 14 ++++++++++++++
 src/third_party/SConscript |  3 +--
 2 files changed, 15 insertions(+), 2 deletions(-)

diff --git a/SConstruct b/SConstruct
index b964eba1ba..458ea95905 100644
--- a/SConstruct
+++ b/SConstruct
@@ -4206,6 +4206,20 @@ def doConfigure(myenv):
         conf.env['LIBDEPS_ICUI18N_SYSLIBDEP'] = 'icui18n'
         conf.env['LIBDEPS_ICUUC_SYSLIBDEP'] = 'icuuc'
 
+    if use_system_version_of_library("abseil-cpp"):
+        # Generated using the CMake targets: absl::hashtablez_sampler absl::hash absl::container
+        # Please note that these are in dependency order. Another way is to throw all of these inside
+        # -Wl,--start-group ... -Wl,--end-group
+        conf.env['LIBDEPS_ABSL_LIBS_SYSLIBDEP'] = [
+            '-labsl_hashtablez_sampler', '-labsl_hash', '-labsl_wyhash', '-labsl_exponential_biased',
+            '-labsl_synchronization', '-labsl_graphcycles_internal', '-labsl_stacktrace', '-labsl_symbolize',
+            '-labsl_malloc_internal', '-labsl_debugging_internal', '-labsl_demangle_internal', '-labsl_time',
+            '-labsl_civil_time', '-labsl_time_zone', '-labsl_strings', '-labsl_base', '-labsl_spinlock_wait',
+            '-labsl_raw_hash_set', '-labsl_int128', '-labsl_throw_delegate', '-labsl_strings_internal',
+            '-labsl_bad_optional_access', '-labsl_bad_variant_access', '-labsl_raw_logging_internal',
+            '-labsl_log_severity', '-labsl_city'
+        ]
+
     if wiredtiger and use_system_version_of_library("wiredtiger"):
         if not conf.CheckCXXHeader( "wiredtiger.h" ):
             myenv.ConfError("Cannot find wiredtiger headers")
diff --git a/src/third_party/SConscript b/src/third_party/SConscript
index 6ee43dbd14..a5e4a30aff 100644
--- a/src/third_party/SConscript
+++ b/src/third_party/SConscript
@@ -348,8 +348,7 @@ abseilEnv = env.Clone()
 if use_system_version_of_library("abseil-cpp"):
     abseilEnv = abseilEnv.Clone(
         SYSLIBDEPS=[
-            env['LIBDEPS_ABSL_CONTAINER_SYSLIBDEP'],
-            env['LIBDEPS_ABSL_HASH_SYSLIBDEP'],
+            env['LIBDEPS_ABSL_LIBS_SYSLIBDEP'],
         ])
 else:
     abseilDirectory = 'abseil-cpp-master'
-- 
2.31.1

