From 40d82886220ad8577d906c1cb6f5ad87ce4acba5 Mon Sep 17 00:00:00 2001
From: Nehal J Wani <nehaljw.kkd1@gmail.com>
Date: Sat, 26 Sep 2020 16:05:30 -0400
Subject: [PATCH 13/13] MSVC: Don't generating debug info forcefully

---
 SConstruct | 38 +++++++++++++++++++-------------------
 1 file changed, 19 insertions(+), 19 deletions(-)

diff --git a/SConstruct b/SConstruct
index c0c27981e1..a21d9c37a3 100644
--- a/SConstruct
+++ b/SConstruct
@@ -2357,11 +2357,11 @@ elif env.TargetOSIs('windows'):
     # Don't send error reports in case of internal compiler error
     env.Append( CCFLAGS= ["/errorReport:none"] )
 
-    # Select debugging format. /Zi gives faster links but seem to use more memory
-    if get_option('msvc-debugging-format') == "codeview":
-        env['CCPDBFLAGS'] = "/Z7"
-    elif get_option('msvc-debugging-format') == "pdb":
-        env['CCPDBFLAGS'] = '/Zi /Fd${TARGET}.pdb'
+#    # Select debugging format. /Zi gives faster links but seem to use more memory
+#    if get_option('msvc-debugging-format') == "codeview":
+#        env['CCPDBFLAGS'] = "/Z7"
+#    elif get_option('msvc-debugging-format') == "pdb":
+#        env['CCPDBFLAGS'] = '/Zi /Fd${TARGET}.pdb'
 
 
     # The SCons built-in pdbGenerator always adds /DEBUG, but we would like
@@ -2374,18 +2374,18 @@ elif env.TargetOSIs('windows'):
             return None
     env['_PDB'] = pdbGenerator
 
-    # /DEBUG will tell the linker to create a .pdb file
-    # which WinDbg and Visual Studio will use to resolve
-    # symbols if you want to debug a release-mode image.
-    # Note that this means we can't do parallel links in the build.
-    #
-    # Please also note that this has nothing to do with _DEBUG or optimization.
-
-    # If the user set a /DEBUG flag explicitly, don't add
-    # another. Otherwise use the standard /DEBUG flag, since we always
-    # want PDBs.
-    if not any(flag.startswith('/DEBUG') for flag in env['LINKFLAGS']):
-        env.Append(LINKFLAGS=["/DEBUG"])
+#    # /DEBUG will tell the linker to create a .pdb file
+#    # which WinDbg and Visual Studio will use to resolve
+#    # symbols if you want to debug a release-mode image.
+#    # Note that this means we can't do parallel links in the build.
+#    #
+#    # Please also note that this has nothing to do with _DEBUG or optimization.
+#
+#    # If the user set a /DEBUG flag explicitly, don't add
+#    # another. Otherwise use the standard /DEBUG flag, since we always
+#    # want PDBs.
+#    if not any(flag.startswith('/DEBUG') for flag in env['LINKFLAGS']):
+#        env.Append(LINKFLAGS=["/DEBUG"])
 
     if optBuild:
         # /O1:  optimize for size
@@ -2452,8 +2452,8 @@ elif env.TargetOSIs('windows'):
     )
 
 # When building on visual studio, this sets the name of the debug symbols file
-if env.ToolchainIs('msvc'):
-    env['PDB'] = '${TARGET.base}.pdb'
+# if env.ToolchainIs('msvc'):
+#     env['PDB'] = '${TARGET.base}.pdb'
 
 # Python uses APPDATA to determine the location of user installed
 # site-packages. If we do not pass this variable down to Python
-- 
2.31.1

